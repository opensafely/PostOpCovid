version: '3.0'

expectations:
  population_size: 50000

actions:

  generate_study_population:
    run: cohortextractor:latest generate_cohort --study-definition study_definition
    outputs:
      highly_sensitive:
        cohort: output/input.csv

  generate_study_population_update_Abdominal:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Abdominal'
      --param indexdate = '2022-03-01'
      --output-file output/input_Abdominal.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal.csv

  generate_study_population_update_Cardiac:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Cardiac'
      --param indexdate = '2022-03-01'
      --output-file output/input_Cardiac.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac.csv

  generate_study_population_update_Obstetrics:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Obstetrics'
      --param indexdate = '2022-03-01'
      --output-file output/input_Obstetrics.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics.csv

  generate_study_population_update_Orthopaedic:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Orthopaedic'
      --param indexdate = '2022-03-01'
      --output-file output/input_Orthopaedic.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic.csv        

  generate_study_population_update_Thoracic:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Thoracic'
      --param indexdate = '2022-03-01'
      --output-file output/input_Thoracic.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic.csv              
        
  generate_study_population_update_Vascular:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update_all
      --param name_op = 'Vascular'
      --param indexdate = '2022-03-01'
      --output-file output/input_Vascular.csv    
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular.csv                   

  generate_study_population_COD:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_COD
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_COD.csv

  data_manage:
    run: r:latest analysis/data_manage.R
    needs: [generate_study_population,generate_study_population_COD,data_manage_update_outcomes]
    outputs:
      highly_sensitive:
        cohort: output/cohort_long.feather
        
  data_manage_update_outcomes:
    run: r:latest analysis/data_manage_update_outcomes.R
    needs: [generate_study_population_update_Abdominal,generate_study_population_update_Cardiac,generate_study_population_update_Obstetrics,generate_study_population_update_Orthopaedic,generate_study_population_update_Thoracic,generate_study_population_update_Vascular,update_study_population_Abdominal_1,update_study_population_Abdominal_2,update_study_population_Abdominal_3,update_study_population_Abdominal_4  ,update_study_population_Abdominal_5,update_study_population_Cardiac_1,update_study_population_Cardiac_2,update_study_population_Cardiac_3,update_study_population_Cardiac_4,update_study_population_Cardiac_5,update_study_population_Obstetrics_1,update_study_population_Obstetrics_2,update_study_population_Obstetrics_3,  update_study_population_Obstetrics_4,update_study_population_Obstetrics_5,update_study_population_Orthopaedic_1,update_study_population_Orthopaedic_2,update_study_population_Orthopaedic_3,update_study_population_Orthopaedic_4,update_study_population_Orthopaedic_5,update_study_population_Thoracic_1,update_study_population_Thoracic_2,update_study_population_Thoracic_3,update_study_population_Thoracic_4,update_study_population_Thoracic_5,update_study_population_Vascular_1,update_study_population_Vascular_2,update_study_population_Vascular_3,update_study_population_Vascular_4,update_study_population_Vascular_5,update_study_population_Abdominal_1_majorminor,update_study_population_Abdominal_2_majorminor,update_study_population_Abdominal_3_majorminor,update_study_population_Abdominal_4_majorminor,update_study_population_Abdominal_5_majorminor,update_study_population_Cardiac_1_majorminor,update_study_population_Cardiac_2_majorminor,update_study_population_Cardiac_3_majorminor,update_study_population_Cardiac_4_majorminor,update_study_population_Cardiac_5_majorminor,update_study_population_Obstetrics_1_majorminor,update_study_population_Obstetrics_4_majorminor,update_study_population_Obstetrics_5_majorminor,update_study_population_Orthopaedic_1_majorminor,update_study_population_Orthopaedic_2_majorminor,update_study_population_Orthopaedic_3_majorminor,update_study_population_Orthopaedic_4_majorminor,update_study_population_Orthopaedic_5_majorminor,update_study_population_Thoracic_1_majorminor,update_study_population_Thoracic_2_majorminor,update_study_population_Thoracic_3_majorminor,update_study_population_Thoracic_4_majorminor,update_study_population_Thoracic_5_majorminor,update_study_population_Vascular_1_majorminor,update_study_population_Vascular_2_majorminor,update_study_population_Vascular_3_majorminor,update_study_population_Vascular_4_majorminor,update_study_population_Vascular_5_majorminor]
    outputs:
      highly_sensitive:
        cohort_outcomes: output/update_outcomes.feather        
        cohort_major: output/update_major.feather     
        cohort_6m: output/update_Sep22.feather

  data_manage_postdisch_week:
    run: r:latest analysis/data_manage_postdisch_weeks.R
    needs: [generate_study_population,data_manage]
    outputs:
      highly_sensitive:
        cohort_splits: output/cohort_postdisch_week_splits.feather

  flowchart:      
    run: r:latest analysis/FlowChart.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:
        flowchart_data: output/flowchart.RData
      moderately_sensitive:
        flowchart_fig: output/Flowchart.pdf
        flowchart_png: output/Flowchart.png
        
  table_demo:      
    run: r:latest analysis/Table_demo.R
    needs: [generate_study_population, data_manage]
    outputs:
      moderately_sensitive:
        table_demo: output/table_demo.csv

  table_postopcovid_crude:      
    run: r:latest analysis/Table_postopcovid_crude.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:
        table_crude: output/postopcovid_crude.RData
      moderately_sensitive:        
        table_crude_csv: output/postopcovid_crude.csv
        
  table_postopcovid_crude_sub:      
    run: r:latest analysis/Table_postopcovid_crude_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:
        table_crude: output/postopcovid_crude_sub.RData
      moderately_sensitive:        
        table_crude_csv: output/postopcovid_crude_sub.csv
       
  table_postopcovid_adjusted:      
    run: r:latest analysis/Table_postopcovid_adjusted.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:    
        table_adjusted: output/postopcovid_adjusted.RData
      moderately_sensitive:
        table_adjusted_csv: output/postopcovid_adjusted.csv
        model_adjusted: output/postopcovidmodel.csv
        model_adjusted_waves: output/postopcovidmodelwaves.csv
        plot_adjusted_waves: output/adjusted_waves_plot.png
       
  # table_postopcovid_adjusted_per_op:      
  #   run: r:latest analysis/Table_postopcovid_adjusted_per_op.R
  #   needs: [generate_study_population, data_manage]
  #   outputs:
  #     moderately_sensitive:
  #       table_adjusted: output/postopcovid_adjusted_per_op.RData
  #       table_adjusted_csv: output/postopcovid_adjusted_per_op*.csv
  # 
  # table_postopcovid_adjusted_bootstrap:      
  #   run: r:latest analysis/Table_postopcovid_adjusted_bootstrap.R
  #   needs: [generate_study_population, data_manage]
  #   outputs:
  #     moderately_sensitive:
  #       samples_adjusted: output/postopcovid_adjusted_bootstrappedIQR.RData
  #       summary_boot_adjusted_csv: output/postopcovid_adjusted_bootstrappedIQR.csv
  # 
  # 
  # table_postopcovid_adjusted_bootstrap_sub:      
  #   run: r:latest analysis/Table_postopcovid_adjusted_bootstrap_sub.R
  #   needs: [generate_study_population, data_manage]
  #   outputs:
  #     moderately_sensitive:
  #       samples_adjusted: output/postopcovid_adjusted_bootstrappedIQR_sub.RData
  #       summary_boot_adjusted_csv: output/postopcovid_adjusted_bootstrappedIQR_sub.csv

  table_postopcovid_adjusted_sub:      
    run: r:latest analysis/Table_postopcovid_adjusted_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_adjusted_sub: output/postopcovid_adjusted_sub.RData      
      moderately_sensitive:
        table_adjusted_sub_csv: output/postopcovid_adjusted_sub.csv
        model_adjusted_sub: output/postopcovidmodelsub.csv
        model_adjusted_waves_sub: output/postopcovidmodelwavessub.csv
        plot_adjusted_waves_sub: output/adjusted_waves_sub_plot.png

  table_postopcovid_tv:      
    run: r:latest analysis/Table_postopcovid_tv.R
    needs: [generate_study_population, data_manage,data_manage_postdisch_week]
    outputs:
      highly_sensitive: 
        table_tv: output/postopcovid_tv.RData
      moderately_sensitive:
        table_tv_csv: output/postopcovid_tv.csv
        model_COVID_tv: output/postopcovidmodelsplit.html
        model_COVID_tv_txt: output/postopcovidmodelsplit.txt
        model_VTE_tv: output/postopVTEmodelsplit.html
        model_VTE_tv_txt: output/postopVTEmodelsplit.txt        
        table_tv_VTE_csv: output/postopcovid_VTE_tv.csv      

  # table_postopcovid_tv_daily:      
  #   run: r:latest analysis/Table_postopcovid_tv_continuous.R
  #   needs: [generate_study_population, data_manage,data_manage_postdisch_week]
  #   outputs:
  #     moderately_sensitive:
  #       table_tv_daily: output/postopcovid_tv_daily.RData
  #       table_tv_csv_daily: output/daily_postopcovid_tv.csv
  #       model_tv_daily: output/postopcovidmodeldaily.html
  #       plot_tv_daily: output/dailyCovidRisk.pdf
  #       table_tv_VTE_csv_daily: output/daily_postopcovid_VTE_tv.csv    
  #       plot_tv_VTE_daily: output/dailyVTERisk.pdf
  #       model_tv_VTE_daily: output/postopVTEmodeldaily.html


  table_postopcovid_tv_sub:      
    run: r:latest analysis/Table_postopcovid_tv_sub.R
    needs: [generate_study_population, data_manage,data_manage_postdisch_week]
    outputs:
      highly_sensitive: 
        table_tv_sub: output/postopcovid_tv_sub.RData
      moderately_sensitive:
        table_tv_sub_csv: output/postopcovid_tv_sub.csv
        model_COVID_tv_sub: output/postopcovidmodelsplitsub.html
        model_COVID_tv_sub_txt: output/postopcovidmodelsplitsub.txt        
        model_VTE_tv_sub: output/postopVTEmodelsplitsub.html
        model_VTE_tv_sub_txt: output/postopVTEmodelsplitsub.txt        
        table_VTE_tv_sub_csv: output/postopcovid_VTE_tv_sub.csv
        
  # table_postopcovid_tv_daily_sub:      
  #   run: r:latest analysis/Table_postopcovid_tv_continuous_sub.R
  #   needs: [generate_study_population, data_manage,data_manage_postdisch_week]
  #   outputs:
  #     moderately_sensitive:
  #       table_tv_daily_sub: output/postopcovid_tv_daily_sub.RData
  #       table_tv_csv_daily_sub: output/daily_postopcovid_tv_sub.csv
  #       model_tv_daily_sub: output/postopcovidmodeldailysub.html
  #       plot_tv_daily_sub: output/dailyCovidRiskSub.pdf
  #       table_tv_VTE_csv_daily_sub: output/daily_postopcovid_VTE_tv_sub.csv    
  #       plot_tv_VTE_daily_sub: output/dailyVTERiskSub.pdf        
  #       model_tv_VTE_daily_sub: output/postopVTEmodeldailysub.html
        
  table_postopLOS:      
    run: r:latest analysis/Table_postoplos.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_los: output/postoplos.RData
      moderately_sensitive:
        table_los_csv: output/postoplos.csv
        model_los: output/postopLOSmodel.csv
        plot_los: output/LOSplot.png
        
  table_postopLOS_sub:      
    run: r:latest analysis/Table_postoplos_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_los_sub: output/postoplos_sub.RData
      moderately_sensitive:
        table_los_sub_csv: output/postoplos_sub.csv
        model_los_sub: output/postopLOSmodel_sub.csv
        plot_los_sub: output/LOSplotsub.png        
        
  table_postopVTE:      
    run: r:latest analysis/Table_postopVTE.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE: output/postopVTE.RData    
      moderately_sensitive:
        table_VTE_csv: output/postopVTE.csv
        model_VTE: output/postopVTEmodel.html
        model_VTE_txt: output/postopVTEmodel.txt        
        plot_VTE_waves: output/VTE_waves_plot.png
        
  table_postopVTE_major_emergency:      
    run: r:latest analysis/coxmodel_major_emergency.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE: output/postopVTE_major_emergency.RData    
      moderately_sensitive:
        table_VTE_csv: output/postopVTE_major_emergency.csv
        model_VTE: output/postopVTEmodel_major_emergency.html
        model_VTE_txt: output/postopVTEmodel_major_emergency.txt        
        plot_VTE_waves: output/VTE_waves_major_emergency.png
        
  table_postopVTE_minor_emergency:      
    run: r:latest analysis/coxmodel_minor_emergency.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE: output/postopVTE_minor_emergency.RData    
      moderately_sensitive:
        table_VTE_csv: output/postopVTE_minor_emergency.csv
        model_VTE: output/postopVTEmodel_minor_emergency.html
        model_VTE_txt: output/postopVTEmodel_minor_emergency.txt        
        plot_VTE_waves: output/VTE_waves_minor_emergency.png     
        
  table_postopVTE_major_elective:      
    run: r:latest analysis/coxmodel_major_elective.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE: output/postopVTE_major_elective.RData    
      moderately_sensitive:
        table_VTE_csv: output/postopVTE_major_elective.csv
        model_VTE: output/postopVTEmodel_major_elective.html
        model_VTE_txt: output/postopVTEmodel_major_elective.txt        
        plot_VTE_waves: output/VTE_waves_major_elective.png   
        
   table_postopVTE_minor_elective:      
    run: r:latest analysis/coxmodel_minor_elective.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE: output/postopVTE_minor_elective.RData    
      moderately_sensitive:
        table_VTE_csv: output/postopVTE_minor_elective.csv
        model_VTE: output/postopVTEmodel_minor_elective.html
        model_VTE_txt: output/postopVTEmodel_minor_elective.txt        
        plot_VTE_waves: output/VTE_waves_minor_elective.png        
        
  table_postopVTErates:      
    run: r:latest analysis/Crude30dayVTE_Rates.R
    needs: [generate_study_population, data_manage]
    outputs:
      moderately_sensitive:
        table_MajElectiveVTErates: output/Major.op_Elective30_day_Crude_VTE_Rates.csv
        table_MajEmergVTErates: output/Major.op_Emergency30_day_Crude_VTE_Rates.csv
        table_MinElectiveVTErates: output/Intermediate.or.Minor.op_Elective30_day_Crude_VTE_Rates.csv
        table_MinEmergVTErates: output/Intermediate.or.Minor.op_Emergency30_day_Crude_VTE_Rates.csv

  table_unadjusted_30dayvte:
    run: r:latest analysis/table_unadjusted_30dayvte.R
    needs: [generate_study_population, data_manage]
    outputs:
      moderately_sensitive:
        table_MajElectiveadjustedrates: output/Major.op_Elective_30_day_adjusted_Analysis.csv
        table_MajEmergadjustedrates: output/Major.op_Emergency_30_day_adjusted_Analysis.csv
        table_MinElectiveadjustedrates: output/Intermediate.or.Minor.op_Elective_30_day_adjusted_Analysis.csv
        table_MinEmergadjustedrates: output/Intermediate.or.Minor.op_Emergency_30_day_adjusted_Analysis.csv
# ##
#   Table_30day_unadjustedVTEanalysis:
#     run: r:latest analysis/Table_30day_unadjustedVTEanalysis.R
#     needs: [generate_study_population, data_manage]
#     outputs:
#       moderately_sensitive:
#         table_30day_unadjustedVTEanalysis_csv: output/postopvte_unadjusted30dayanalysis.csv
#         table_30day_unadjustedVTEanalysis: output/postopvte_unadjusted30dayanalysis.RData ##
    
  table_30day_adjustedVTEanalysis:
    run: r:latest analysis/Table_30day_adjustedVTEanalysis.R
    needs: [generate_study_population, data_manage]
    outputs:
      moderately_sensitive:
        table_30day_adjustedVTEanalysis_csv: output/postopvte_fullyadjusted30dayanalysis.csv
        
  table_emergency_elective_30dayVTE:
    run: r:latest analysis/Table_emergency_elective_30dayVTE.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:
        table_postopvte_fullyadjusted30dayanalysis_emergency: postopvte_fullyadjusted30dayanalysis_emergency.RData
        table_postopvte_fullyadjusted30dayanalysis_elective: postopvte_fullyadjusted30dayanalysis_elective.RData
      moderately_sensitive:
        table_postopvte_fullyadjusted30dayanalysis_emergency: output/postopvte_fullyadjusted30dayanalysis_emergency.csv
         
         
  table_30day_cumulative_incidence_waves:
    run: r:latest analysis/table_30day_cumulative_incidence_waves.R
    needs: [generate_study_population, data_manage]
    outputs:
      moderately_sensitive:
        table_30day_adjustedVTEanalysis_csv: output/table_postop_VTEincidence_by_procedure_wave.csv
        



  table_postopVTE_sub:      
    run: r:latest analysis/Table_postopVTE_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_VTE_sub: output/postopVTE_sub.RData
      moderately_sensitive:
        table_VTE_sub_csv: output/postopVTE_sub.csv        
        model_VTE_sub: output/postopVTEmodelsub.html
        model_VTE_sub_txt: output/postopVTEmodelsub.txt        
        plot_VTE_sub_waves: output/VTE_waves_sub_plot.png

  table_postopVTE_recent:      
    run: r:latest analysis/Table_postopVTE_recent.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_VTE_recent: output/postopVTErecent.RData
      moderately_sensitive:
        table_VTE_recent_csv: output/postopVTE_recentCOVID.csv
        model_VTE_recent: output/postopVTEmodelrecentCOVID.html
        model_VTE_recent_txt: output/postopVTEmodelrecentCOVID.txt        
        plot_VTE_recent_waves: output/VTE_waves_recentCOVID_plot.png
        
  table_postopVTE_recent_sub:      
    run: r:latest analysis/Table_postopVTE_recent_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_VTE_recent_sub: output/postopVTErecent_sub.RData
      moderately_sensitive:
        table_VTE_recent_sub_csv: output/postopVTE_recentCOVID_sub.csv       
        model_VTE_recent_sub: output/postopVTEmodelrecentCOVIDsub.html
        model_VTE_recent_sub_txt: output/postopVTEmodelrecentCOVIDsub.txt        
        plot_VTE_recent_sub_waves: output/VTE_waves_recentCOVID_sub_plot.png
       
  table_postopmortality:      
    run: r:latest analysis/Table_postopmortality.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_mortality: output/postopmortality.RData    
      moderately_sensitive:
        table_mortality_csv: output/postopmortality.csv
        model_mortality: output/postopdiedmodel.html
        model_mortality_txt: output/postopdiedmodel.txt        
        plot_mortality: output/mortality_waves_plot.png
        
  table_postopmortality_sub:      
    run: r:latest analysis/Table_postopmortality_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_mortality_sub: output/postopmortality_sub.RData  
      moderately_sensitive:
        table_mortality_sub_csv: output/postopmortality_sub.csv
        model_mortality_sub: output/postopdiedmodelsub.html
        model_mortality_sub_txt: output/postopdiedmodelsub.txt        
        plot_mortality_sub: output/mortality_waves_sub_plot.png
  
  table_postopmort_crude:      
    run: r:latest analysis/Table_postopcovid_mort_crude.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:   
        table_crudemort: output/postopmort_crude.RData
      moderately_sensitive:
        table_crudemort_csv: output/postopmort_crude.csv
        
  table_postopmort_crude_sub:      
    run: r:latest analysis/Table_postopcovid_mort_crude_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive: 
        table_crudemort: output/postopmort_crude_sub.RData      
      moderately_sensitive:
        table_crudemort_csv: output/postopmort_crude_sub.csv
       
  table_postopmort_adjusted:      
    run: r:latest analysis/Table_postopcovid_mort_adjusted.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:     
        table_adjustedmort: output/postopmort_adjusted.RData
      moderately_sensitive:
        table_adjustedmort_csv: output/postopmort_adjusted.csv

       
  table_postopmort_adjusted_sub:      
    run: r:latest analysis/Table_postopcovid_mort_adjusted_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:     
        table_adjustedmort_sub: output/postopmort_adjusted_sub.RData
      moderately_sensitive:
        table_adjustedmort_sub_csv: output/postopmort_adjusted_sub.csv
        
  table_postopreadmit:      
    run: r:latest analysis/Table_postop_readmit.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:     
        table_readmit: output/postopreadmit.RData
      moderately_sensitive:
        table_readmit_csv: output/postopreadmit.csv
        model_readmit: output/postopreadmitmodel.html
        model_readmit_txt: output/postopreadmitmodel.txt        
        plot_readmit: output/readmit_waves_plot.png        
        
  table_postopreadmit_sub:      
    run: r:latest analysis/Table_postop_readmit_sub.R
    needs: [generate_study_population, data_manage]
    outputs:
      highly_sensitive:     
        table_readmit_sub: output/postopreadmit_sub.RData
      moderately_sensitive:
        table_readmit_sub_csv: output/postopreadmit_sub.csv
        model_readmit_sub: output/postopreadmitmodelsub.html
        model_readmit_sub_txt: output/postopreadmitmodelsub.txt        
        plot_readmit_sub: output/readmit_waves_sub_plot.png

  report:
    run: r:latest -e 'rmarkdown::render("analysis/Report.rmd", output_dir = "/workspace/output/",knit_root_dir = "/workspace",)'    
    needs: [generate_study_population, data_manage, data_manage_postdisch_week,
    flowchart,
    table_demo,
    table_postopcovid_crude,
    table_postopcovid_adjusted,
    table_postopcovid_tv,
#    table_postopcovid_tv_daily,
    table_postopLOS,
    table_postopVTE,
    table_postopVTE_recent,
    table_postopmortality,
    table_postopreadmit,
    table_postopcovid_crude_sub,
    table_postopcovid_adjusted_sub,
    table_postopcovid_tv_sub,
 #   table_postopcovid_tv_daily_sub,
    table_postopLOS_sub,
    table_postopVTE_sub,
    table_postopVTE_recent_sub,
    table_postopmortality_sub,
    table_postopmort_crude,
    table_postopmort_adjusted,    
    table_postopmort_crude_sub,
    table_postopmort_adjusted_sub,    
    table_postopreadmit_sub]
    outputs:
      moderately_sensitive:
        results_report: output/Report.html
        

  update_study_population_Abdominal_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_1.csv

  update_study_population_Abdominal_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_2.csv
        
  update_study_population_Abdominal_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_3.csv
        
  update_study_population_Abdominal_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_4.csv
        
  update_study_population_Abdominal_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_5.csv       

  update_study_population_Cardiac_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_1.csv

  update_study_population_Cardiac_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_2.csv
        
  update_study_population_Cardiac_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_3.csv
        
  update_study_population_Cardiac_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_4.csv
        
  update_study_population_Cardiac_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_5.csv       
        
  update_study_population_Obstetrics_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_1.csv

  update_study_population_Obstetrics_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_2.csv
        
  update_study_population_Obstetrics_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_3.csv
        
  update_study_population_Obstetrics_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_4.csv
        
  update_study_population_Obstetrics_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_5.csv       
        
  update_study_population_Orthopaedic_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_1.csv

  update_study_population_Orthopaedic_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_2.csv
        
  update_study_population_Orthopaedic_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_3.csv
        
  update_study_population_Orthopaedic_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_4.csv
        
  update_study_population_Orthopaedic_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_5.csv               



  update_study_population_Thoracic_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_1.csv

  update_study_population_Thoracic_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_2.csv
        
  update_study_population_Thoracic_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_3.csv
        
  update_study_population_Thoracic_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_4.csv
        
  update_study_population_Thoracic_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_5.csv   
        


  update_study_population_Vascular_1:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '1'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_1.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_1.csv

  update_study_population_Vascular_2:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '2'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_2.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_2.csv
        
  update_study_population_Vascular_3:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '3'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_3.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_3.csv
        
  update_study_population_Vascular_4:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '4'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_4.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_4.csv
        
  update_study_population_Vascular_5:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_update
      --param n_op = '5'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_5.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_5.csv        
        
##  Update for major minor



  update_study_population_Abdominal_1_majorminor :
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_1_majorminor.csv

  update_study_population_Abdominal_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_2_majorminor.csv
        
  update_study_population_Abdominal_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_3_majorminor.csv
        
  update_study_population_Abdominal_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_4_majorminor.csv
        
  update_study_population_Abdominal_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Abdominal'
      --output-file output/input_Abdominal_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Abdominal_5_majorminor.csv       

  update_study_population_Cardiac_1_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_1_majorminor.csv

  update_study_population_Cardiac_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_2_majorminor.csv
        
  update_study_population_Cardiac_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_3_majorminor.csv
        
  update_study_population_Cardiac_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_4_majorminor.csv
        
  update_study_population_Cardiac_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Cardiac'
      --output-file output/input_Cardiac_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Cardiac_5_majorminor.csv       
        
  update_study_population_Obstetrics_1_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_1_majorminor.csv

  update_study_population_Obstetrics_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_2_majorminor.csv
        
  update_study_population_Obstetrics_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_3_majorminor.csv
        
  update_study_population_Obstetrics_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_4_majorminor.csv
        
  update_study_population_Obstetrics_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Obstetrics'
      --output-file output/input_Obstetrics_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Obstetrics_5_majorminor.csv       
        
  update_study_population_Orthopaedic_1_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_1_majorminor.csv

  update_study_population_Orthopaedic_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_2_majorminor.csv
        
  update_study_population_Orthopaedic_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_3_majorminor.csv
        
  update_study_population_Orthopaedic_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_4_majorminor.csv
        
  update_study_population_Orthopaedic_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Orthopaedic'
      --output-file output/input_Orthopaedic_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Orthopaedic_5_majorminor.csv               



  update_study_population_Thoracic_1_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_1_majorminor.csv

  update_study_population_Thoracic_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_2_majorminor.csv
        
  update_study_population_Thoracic_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_3_majorminor.csv
        
  update_study_population_Thoracic_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_4_majorminor.csv
        
  update_study_population_Thoracic_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Thoracic'
      --output-file output/input_Thoracic_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Thoracic_5_majorminor.csv   
        


  update_study_population_Vascular_1_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '1'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_1_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_1_majorminor.csv

  update_study_population_Vascular_2_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '2'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_2_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_2_majorminor.csv
        
  update_study_population_Vascular_3_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '3'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_3_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_3_majorminor.csv
        
  update_study_population_Vascular_4_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '4'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_4_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_4_majorminor.csv
        
  update_study_population_Vascular_5_majorminor:
    run: cohortextractor:latest generate_cohort --study-definition study_definition_MajorMinor
      --param n_op = '5'
      --param name_op = 'Vascular'
      --output-file output/input_Vascular_5_majorminor.csv
    needs: [generate_study_population]
    outputs:
      highly_sensitive:
        cohort: output/input_Vascular_5_majorminor.csv   